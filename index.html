<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rastreador Financiero</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <header>
        <h1>Rastreador Financiero Personal</h1>
    </header>

    <main>

        <section aria-label="Configuración de ingreso y asignación" class="seccion-principal">
            <h2>Configuración</h2>
            <form id="formIngreso" class="formulario">
                <div class="form-group">
                    <label for="inputIngresoBase">Ingreso ($):</label>
                    <input type="number" id="inputIngresoBase" step="0.01" min="0" required>
                </div>
            </form>
            <div class="ingreso-actual">
                <p>Tu ingreso: <span id="ingresoBaseMostrado">$0.00</span></p>
                <p>Saldo total: <span id="saldoTotalMostrado">$0.00</span></p>
            </div>
            
            <h3>Regla 50/30/20</h3>
            <div id="barraAsignacion" class="barra-asignacion"></div>

            <form id="formAsignacion" class="formulario">
                <div class="form-group">
                    <label for="inputAsignacionNecesidad">Gastos Fijos (50%): <span id="sugerenciaNecesidad" class="sugerencia"></span></label>
                    <input type="number" id="inputAsignacionNecesidad" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="inputAsignacionDeseo">Gastos Variables (30%): <span id="sugerenciaDeseo" class="sugerencia"></span></label>
                    <input type="number" id="inputAsignacionDeseo" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="inputAsignacionAhorro">Ahorro (20%): <span id="sugerenciaAhorro" class="sugerencia"></span></label>
                    <input type="number" id="inputAsignacionAhorro" step="0.01" required>
                </div>
                <div class="total-asignado">
                    Total asignado: <span id="totalAsignado">$0.00</span>
                </div>
                <p id="errorAsignacion" class="mensaje-error"></p>
                <button id="btnGuardarAsignacion" class="btn-primario" type="submit">Guardar asignaciones</button>
            </form>
        </section>

        <hr>

        <section aria-label="Agregar nuevo movimiento" class="seccion-principal">
            <h2>Agregar nuevo movimiento</h2>
            <form id="formMovimiento" class="formulario">
                <div class="form-group">
                    <label for="inputFecha">Fecha:</label>
                    <input type="date" id="inputFecha" required>
                </div>
                <div class="form-group">
                    <label for="selectCategoria">Categoría:</label>
                    <select id="selectCategoria" required>
                        <option value="" disabled selected>Seleccione...</option>
                        <option value="Ingreso">Ingreso</option>
                        <option value="Gastos Fijos">Gastos Fijos</option>
                        <option value="Gastos Variables">Gastos Variables</option>
                        <option value="Ahorro">Ahorro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="btnSeleccionarSubcategoria">Subcategoría:</label>
                    <button id="btnSeleccionarSubcategoria" type="button" class="btn-secundario">Seleccionar...</button>
                    <input type="hidden" id="inputSubcategoria" required>
                </div>
                <div class="form-group">
                    <label for="inputMonto">Monto ($):</label>
                    <input type="number" id="inputMonto" step="0.01" min="0" required>
                </div>
                <button type="submit" class="btn-primario">Registrar movimiento</button>
            </form>
        </section>

        <hr>

        <section aria-label="Resumen de gastos y saldos" class="seccion-principal">
            <h2>Resumen</h2>
            <div id="saldos" class="saldos-contenedor"></div>
            <div class="graficos">
                <div class="grafico-item">
                    <h3>Presupuesto vs. Gasto (Semanal/Mensual)</h3>
                    <canvas id="graficoPresupuesto"></canvas>
                </div>
                <div class="grafico-item">
                    <h3>Tendencia Mensual de Gastos</h3>
                    <canvas id="graficoTendencia"></canvas>
                </div>
            </div>

            <h3>Resumen total por categoría</h3>
            <table class="tabla-resumen">
                <thead>
                    <tr>
                        <th>Categoría</th>
                        <th>Presupuesto</th>
                        <th>Gastado</th>
                        <th>% Gastado</th>
                    </tr>
                </thead>
                <tbody id="resumenMensual-body">
                </tbody>
            </table>
        </section>

        <hr>

        <section aria-label="Historial de movimientos" class="seccion-principal">
            <h2>Historial de movimientos</h2>
            <div class="controles-historial">
                <div class="form-group">
                    <label for="filtroCategoria">Filtrar por categoría:</label>
                    <select id="filtroCategoria">
                        <option value="">Todas</option>
                        <option value="Ingreso">Ingreso</option>
                        <option value="Gastos Fijos">Gastos Fijos</option>
                        <option value="Gastos Variables">Gastos Variables</option>
                        <option value="Ahorro">Ahorro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="filtroTiempo">Filtrar por periodo:</label>
                    <select id="filtroTiempo">
                        <option value="semana">Semana actual</option>
                        <option value="mes">Mes actual</option>
                    </select>
                </div>
            </div>
            <p id="movimientosTotales">Movimientos mostrados: 0</p>
            <div class="tabla-contenedor">
                <table class="tabla-movimientos">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Día</th>
                            <th>Semana</th>
                            <th>Categoría</th>
                            <th>Subcategoría</th>
                            <th>Monto ($)</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaMovimientos-body">
                    </tbody>
                </table>
            </div>

            <div class="controles-adicionales">
                <button id="btnExportarCSV" class="btn-secundario">Exportar a CSV</button>
                <button id="btnLimpiarDatos" class="btn-primario">Limpiar todos los datos</button>
                <button id="btnIniciarNuevoMes" class="btn-primario">Iniciar nuevo mes</button>
            </div>
            
            <div id="historialMeses" class="historial-meses"></div>
        </section>
        
        <dialog id="modalSubcategorias">
            <h3 class="modal-titulo">Seleccionar Subcategoría</h3>
            <p>Selecciona una subcategoría existente o agrega una nueva.</p>
            <ul id="listaSubcategorias" class="lista-modal"></ul>
            <div class="modal-footer">
                <input type="text" id="inputNuevaSubcategoria" placeholder="Agregar nueva subcategoría">
                <button id="btnAgregarSubcategoria" class="btn-secundario">Agregar</button>
            </div>
            <button id="btnCerrarModal" class="btn-primario">Cerrar</button>
        </dialog>

    </main>
    
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('service-worker.js')
            .then(registration => {
              console.log('Service Worker registrado con éxito:', registration);
            })
            .catch(error => {
              console.log('Registro del Service Worker fallido:', error);
            });
        });
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>
</body>
</html>
